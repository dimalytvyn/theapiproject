@model MemberViewModel
@{
    var currentRole = Model.roles.FirstOrDefault();
}
<link rel="stylesheet" href="~/css/profile.css" />

<div class="p-3 mb-3 text-white-50 bg-@GetPartyColor() rounded shadow-sm">
    <div class="lh-100">
        <div class="row">
            <div class="col-md">
                <h6 class="mb-0 text-white lh-100">
                    @if (!string.IsNullOrEmpty(Model.party))
                    {
                        <span>(</span>@Model.party<span>)</span>
                    }
                    @currentRole?.short_title
                    @Model.first_name
                    @if (!string.IsNullOrEmpty(Model.middle_name))
                    {
                        @Model.middle_name
                    }
                    @Model.last_name
                    @if (!string.IsNullOrEmpty(Model.suffix))
                    {
                        @Model.suffix
                    }
                </h6>
            </div>
            <div class="col-md-auto text-right">
                <ul class="list-inline mb-1">
                    @if (!string.IsNullOrEmpty(Model.twitter_account))
                    {
                        <li class="list-inline-item">
                            <a class="text-white" href="https://twitter.com/@Model.twitter_account">
                                <span data-feather="twitter"></span>
                            </a>
                        </li>
                    }
                    @if (!string.IsNullOrEmpty(Model.facebook_account))
                    {
                        <li class="list-inline-item">
                            <a class="text-white" href="https://facebook.com/@Model.facebook_account">
                                <span data-feather="facebook"></span>
                            </a>
                        </li>
                    }
                    @if (!string.IsNullOrEmpty(Model.youtube_account))
                    {
                        <li class="list-inline-item">
                            <a class="text-white" href="https://youtube.com/@Model.youtube_account">
                                <span data-feather="youtube"></span>
                            </a>
                        </li>
                    }
                    @if (!string.IsNullOrEmpty(Model.rss_url))
                    {
                        <li class="list-inline-item">
                            <a class="text-white" href="@Model.rss_url">
                                <span data-feather="rss"></span>
                            </a>
                        </li>
                    }
                </ul>
            </div>
        </div>
        @if (!string.IsNullOrEmpty(Model.most_recent_vote))
        {
            <div class="row">
                <div class="col">
                    Most Recent Vote:
                    <small>
                        @Convert.ToDateTime(Model.most_recent_vote).ToShortDateString()
                    </small>
                </div>
            </div>
        }
    </div>
</div>
<div class="my-3">
    <h5 class="mb-3 p-2">
        <span data-feather="calendar"></span>
        Terms
    </h5>
    @if (Model.roles?.Count > 0)
    {
<div class="table-responsive">
    <table id="tbl_terms" class="table table-sm">
        <thead class="thead-dark">
            <tr>
                <th class="d-none">
                    Congress
                </th>
                <th>
                    Congress
                </th>
                <th>
                    Term
                </th>
                <th>
                    Votes With Party
                </th>
                <th>
                    Sponsored Bills
                </th>
                <th>
                    Co-sponsored Bills
                </th>
                <th>
                    Missed Votes
                </th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.roles?.Count; i++)
            {
                var role = Model.roles[i];
            <tr>
                <td class="d-none">
                    @role.congress
                </td>
                <td>
                    <span class="h3 font-weight-light">
                        @role.congress@GetOrdinalSuffix(Convert.ToInt32(role.congress))
                    </span>
                </td>
                <td>
                    @Convert.ToDateTime(role.start_date).Year to
                    @Convert.ToDateTime(role.end_date).Year
                </td>
                <td>
                    @if (role.votes_with_party_pct != null)
                    {
                        <span class="badge badge-@GetPartyColor() badge-pill">
                            @role.votes_with_party_pct%
                        </span>
                    }
                    else
                    {
                        <span class="text-muted">
                            N/A
                        </span>
                    }
                </td>
                <td>
                    @if (role.bills_sponsored != null)
                    {
                        <span class="badge badge-success badge-pill">
                            @role.bills_sponsored
                        </span>
                    }
                    else
                    {
                        <span class="text-muted">
                            N/A
                        </span>
                    }
                </td>
                <td>
                    @if (role.bills_cosponsored != null)
                    {
                        <span class="badge badge-info badge-pill">
                            @role.bills_cosponsored
                        </span>
                    }
                    else
                    {
                        <span class="text-muted">
                            N/A
                        </span>
                    }
                </td>
                <td>
                    @if (role.missed_votes_pct != null)
                    {
                        <span class="badge badge-warning badge-pill">
                            @role.missed_votes_pct%
                        </span>
                    }
                    else
                    {
                        <span class="text-muted">
                            N/A
                        </span>
                    }
                </td>
            </tr>
            }
        </tbody>
    </table>
</div>
    }
    else
    {
        <div class="media text-muted pt-3">
            <div class="media-body pb-3 mb-0 lh-125">
                <p class="text-danger">
                    There are no terms for this member.
                </p>
            </div>
        </div>
    }
</div>


<div class="my-3">
    <h5 class="mb-3 p-2">
        <span data-feather="thumbs-up"></span>
        Votes
    </h5>
    @if (Model.votes?.Count > 0)
    {
<div class="table-responsive">
    <table id="tbl_votes" class="table table-hover table-sm">
        <thead class="thead-dark">
            <tr>
                <th>
                    Position
                </th>
                <th>
                    Date
                </th>
                <th>
                    Result
                </th>
                <th>
                    Vote
                </th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.votes.Count; i++)
            {
                var vote = Model.votes[i];
                <tr>
                    <td class="text-center w-auto">
                        <a class="text-decoration-none" href="/Votes/Details?congress=@vote.congress&chamber=@vote.chamber&sessionNumber=@vote.session&rollCallNumber=@vote.roll_call">
                            <span class="h3 font-weight-light @GetYesNoColor(vote.position)">
                                @vote.position
                            </span>
                        </a>
                    </td>
                    <td>
                        @Convert.ToDateTime(vote.date).ToShortDateString()
                    </td>
                    <td>
                        @vote.result
                    </td>
                    <td>
                        <strong>
                            @vote.question
                        </strong>
                        <br />
                        @vote.description
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
        
    }
    else
    {
        <div class="media text-muted pt-3">
            <div class="media-body pb-3 mb-0 lh-125">
                <p class="text-danger">
                    There are no votes from this member.
                </p>
            </div>
        </div>
    }
</div>


<div class="my-3">
    <h5 class="mb-3 p-2">
        <span data-feather="file"></span>
        Sponsored Bills
    </h5>
    @if (Model.bills?.Count > 0)
    {
<div class="table-responsive">
    <table id="tbl_sponsored_bills" class="table table-sm table-hover">
        <thead class="thead-dark">
            <tr>
                <th>
                    Bill
                </th>
                <th>
                    Updated
                </th>
                <th>
                    Details
                </th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.bills.Count; i++)
            {
                var bill = Model.bills[i];
                <tr>
                    <td class="text-center w-auto">
                        <a class="text-decoration-none" href="/Bills/Details?id=@bill.bill_slug&congress=@bill.congress">
                            <strong class="text-gray-dark h3 mb-2 font-weight-light">
                                @bill.bill_id.Replace($"-{bill.congress}", string.Empty)
                            </strong>
                        </a>
                    </td>
                    <td>
                        @Convert.ToDateTime(bill.latest_major_action_date).ToShortDateString()
                    </td>
                    <td>
                        <strong>
                            @bill.latest_major_action
                        </strong>
                        <br />
                        @bill.title
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
        
    }
    else
    {
        <div class="media text-muted pt-3">
            <div class="media-body pb-3 mb-0 lh-125">
                <p class="text-danger">
                    There are been no bills sponsored by this member.
                </p>
            </div>
        </div>
    }
</div>

<div class="my-3">
    <h5 class="mb-3 p-2">
        <span data-feather="file-plus"></span>
        Co-sponsored Bills
    </h5>
    @if (Model.cosponsoredBills?.Count > 0)
    {
<div class="table-responsive">
    <table id="tbl_co_sponsored_bills" class="table table-sm table-hover">
        <thead class="thead-dark">
            <tr>
                <th>
                    Bill
                </th>
                <th>
                    Updated
                </th>
                <th>
                    Details
                </th>
                <th>
                    Sponsor
                </th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.cosponsoredBills.Count; i++)
            {
                var bill = Model.cosponsoredBills[i];
                <tr>
                    <td class="w-auto text-center">
                        <a class="text-decoration-none" href="/Bills/Details?id=@bill.bill_slug&congress=@bill.congress">
                            <strong class="text-gray-dark h3 mb-2 font-weight-light">
                                @bill.bill_id.Replace($"-{bill.congress}", string.Empty)
                            </strong>
                        </a>
                    </td>
                    <td>
                        @Convert.ToDateTime(bill.latest_major_action_date).ToShortDateString()
                    </td>
                    <td>
                        <strong class="text-muted">
                            @bill.latest_major_action
                        </strong>
                        <br />
                        @bill.title
                    </td>
                    <td>
                        <a href="/Members/Details/@bill.sponsor_id">
                            (@bill.sponsor_party) @bill.sponsor
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
        
    }
    else
    {
        <div class="media text-muted pt-3">
            <div class="media-body pb-3 mb-0 lh-125">
                <p class="text-danger">
                    There are been no bills co-sponsored by this member.
                </p>
            </div>
        </div>
    }
</div>
@section Scripts{
    <script src="~/js/Members/Details.cshtml.js" asp-append-version="true"></script>
}

@functions{
    string GetPartyColor()
    {
        var partycolor = "dark";
        switch (Model.party)
        {
            case "R":
                partycolor = "danger";
                break;
            case "D":
                partycolor = "primary";
                break;
            case "I":
                partycolor = "secondary";
                break;
        }
        return partycolor;
    }

    string GetOrdinalSuffix(int num)
    {
        if (num.ToString().EndsWith("11")) return "th";
        if (num.ToString().EndsWith("12")) return "th";
        if (num.ToString().EndsWith("13")) return "th";
        if (num.ToString().EndsWith("1")) return "st";
        if (num.ToString().EndsWith("2")) return "nd";
        if (num.ToString().EndsWith("3")) return "rd";
        return "th";
    }
    string GetYesNoColor(string yesNo)
    {
        switch (yesNo.ToLower())
        {
            case "yes":
                return "text-success";
            case "no":
                return "text-danger";
        }
        return string.Empty;
    }
}